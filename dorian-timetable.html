<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dorian's Timetable - 3rd Grade</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    :root {
      --bg: #f8faff;
      --text: #333;
      --card: #fff;
      --header-bg: #4f46e5;
      --header-text: #fff;
      --border: #ddd;
      --cell-border: #eee;
    }

    body.dark {
      --bg: #1e1e2f;
      --text: #e0e0e0;
      --card: #2c2c3c;
      --header-bg: #6366f1;
      --header-text: #fff;
      --border: #444;
      --cell-border: #555;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    h2, h3 {
      text-align: center;
      font-size: 1rem;
      margin: 4px 0;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    select, button {
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
    }

    button:hover, select:hover {
      opacity: 0.9;
    }

    .timetable {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    max-width: 800px;
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    background: var(--card);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    margin: 20px auto;
    overflow-x: auto;
    }

    .timetable div {
      border: 1px solid var(--cell-border);
      padding: 12px;
      text-align: center;
      font-size: 0.9rem;
      position: relative;
    }

    .header {
      background: var(--header-bg);
      color: var(--header-text);
      font-weight: bold;
    }

    /* New CSS for highlighting */
    .current-day-header {
      background: #e6e6ff; /* A lighter shade for a subtle highlight */
      color: #6366f1;
      border: 2px solid #6366f1;
    }

    body.dark .current-day-header {
      background: #e6e6ff;
      color: #6366f1;
    }

    .current-lesson {
      background: #d1e7dd; /* Light green for current lesson */
      color: #155724;
      font-weight: bold;
    }

    body.dark .current-lesson {
      background: #28a745;
      color: #fff;
    }

    /* Blinking effect */
    @keyframes blink {
      0% { box-shadow: 0 0 5px #ffeb3b; }
      50% { box-shadow: 0 0 10px #ffeb3b; }
      100% { box-shadow: 0 0 5px #ffeb3b; }
    }

    .blinking {
      animation: blink 2s infinite;
    }

    /* Tooltip styling */
    .tooltip {
      position: fixed;
      background: #6366f1;
      color: #fff;
      padding: 5px 8px;
      border-radius: 5px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 10;
    }

    @media (max-width: 768px) {
      .timetable div {
        font-size: 0.75rem;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <h1 id="title"></h1>
  <div class="controls">
    <button id="theme-toggle">🌙 Dark</button>
    <button id="shift-toggle">Switch Shift</button>
    <select id="language-select">
      <option value="en">English 🇬🇧</option>
      <option value="bs">Bosanski 🇧🇦</option>
      <option value="tr">Türkçe 🇹🇷</option>
    </select>
  </div>
  <h2 id="today-date"></h2>
  <h3 id="shift-label"></h3>
  <h3 id="shift-time"></h3>

  <div class="timetable" id="timetable"></div>

  <script>
    const translations = {
      en: {
        title: "Dorian's Timetable - 3B",
        morning: "Morning Shift",
        afternoon: "Afternoon Shift",
        morningTime: "from 08:00 to 11:30",
        afternoonTime: "from 14:00 to 17:30",
        morningTimeFriday: "from 08:00 to 10:40",
        afternoonTimeFriday: "from 14:00 to 16:40",
        days: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
        locale: "en-GB",
        subjects: {
          'BHS': 'BHS Language & Literature',
          'ENG': 'English',
          'MO': 'My Environment',
          'MAT': 'Mathematics',
          'MSC': 'Music',
          'LK': 'Art',
          'DKR': 'Society/Culture/Religion',
          'TZO': 'Physical & Health Education',
          'INFO': 'Computer Science'
        }
      },
      bs: {
        title: "Dorianov Raspored Časova - 3B",
        morning: "Prva smjena",
        afternoon: "Druga smjena",
        morningTime: "od 08:00 do 11:30",
        afternoonTime: "od 14:00 do 17:30",
        morningTimeFriday: "od 08:00 do 10:40",
        afternoonTimeFriday: "od 14:00 do 16:40",
        days: ["Ponedjeljak", "Utorak", "Srijeda", "Četvrtak", "Petak"],
        locale: "bs-BA",
        subjects: {
          'BHS': 'BHS Jezik i književnost',
          'ENG': 'Engleski jezik',
          'MO': 'Moja Okolina',
          'MAT': 'Matematika',
          'MSC': 'Muzička kultura',
          'LK': 'Likovna kultura',
          'DKR': 'Društvo/Kultura/Religija',
          'TZO': 'Tjelesni i zdravstveni odgoj',
          'INFO': 'Informatika'
        }
      },
      tr: {
        title: "Dorian'ın Ders Programı - 3B",
        morning: "Sabahçı",
        afternoon: "Öğlenci",
        morningTime: "08:00 - 11:30",
        afternoonTime: "14:00 - 17:30",
        morningTimeFriday: "08:00 - 10:40",
        afternoonTimeFriday: "14:00 - 16:40",
        days: ["Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma"],
        locale: "tr-TR",
        subjects: {
          'BHS': 'BHS Dil ve Edebiyat',
          'ENG': 'İngilizce',
          'MO': 'Çevrem',
          'MAT': 'Matematik',
          'MSC': 'Müzik',
          'LK': 'Resim',
          'DKR': 'Toplum/Kültür/Din',
          'TZO': 'Beden Eğitimi',
          'INFO': 'Bilgisayar Bilimi'
        }
      }
    };

    const timetableData = {
      morning: {
        'Monday': ['ENG', 'BHS', 'MSC', 'MAT'],
        'Tuesday': ['TZO', 'DKR', 'BHS', 'MO'],
        'Wednesday': ['MAT', 'INFO', 'MO', 'ENG'],
        'Thursday': ['LK', 'BHS', 'TZO', 'MSC'],
        'Friday': ['BHS', 'MAT', 'LK']
      },
      afternoon: {
        'Monday': ['ENG', 'BHS', 'MSC', 'MAT'],
        'Tuesday': ['TZO', 'DKR', 'BHS', 'MO'],
        'Wednesday': ['MAT', 'INFO', 'MO', 'ENG'],
        'Thursday': ['LK', 'BHS', 'TZO', 'MSC'],
        'Friday': ['BHS', 'MAT', 'LK']
      }
    };

    // Define lesson times in minutes from midnight (e.g., 8:00 is 8*60 = 480)
    const lessonTimes = {
      morning: [
        { start: 8 * 60, end: 8 * 60 + 45 },
        { start: 8 * 60 + 50, end: 9 * 60 + 35 },
        { start: 9 * 60 + 55, end: 10 * 60 + 40 },
        { start: 10 * 60 + 45, end: 11 * 60 + 30 }
      ],
      afternoon: [
        { start: 14 * 60, end: 14 * 60 + 45 },
        { start: 14 * 60 + 50, end: 15 * 60 + 35 },
        { start: 15 * 60 + 55, end: 16 * 60 + 40 },
        { start: 16 * 60 + 45, end: 17 * 60 + 30 }
      ],
      morningFriday: [
        { start: 8 * 60, end: 8 * 60 + 45 },
        { start: 8 * 60 + 50, end: 9 * 60 + 35 },
        { start: 9 * 60 + 55, end: 10 * 60 + 40 }
      ],
      afternoonFriday: [
        { start: 14 * 60, end: 14 * 60 + 45 },
        { start: 14 * 60 + 50, end: 15 * 60 + 35 },
        { start: 15 * 60 + 55, end: 16 * 60 + 40 }
      ]
    };

    // Reference: week of 1st September 2025 = Afternoon
    function getShiftForWeek(date) {
      const referenceDate = new Date(2025, 8, 1); // Sep 1, 2025
      const oneWeek = 1000 * 60 * 60 * 24 * 7;
      const diffWeeks = Math.floor((date - referenceDate) / oneWeek);
      return diffWeeks % 2 === 0 ? 'afternoon' : 'morning';
    }

    function buildTimetable(shift, lang) {
      const table = document.getElementById("timetable");
      table.innerHTML = "";

      const tr = translations[lang];
      const days = tr.days;

      // Header row
      days.forEach(day => {
        const headerCell = createCell(day, "header");
        table.appendChild(headerCell);
      });

      // Max lessons in a day
      const maxPeriods = Math.max(...Object.values(timetableData[shift]).map(d => d.length));

      for (let p = 0; p < maxPeriods; p++) {
        Object.keys(timetableData[shift]).forEach((dayKey, idx) => {
          const code = timetableData[shift][dayKey][p] || "";
          const full = tr.subjects[code] || "";
          table.appendChild(createCell(code, "", full));
        });
      }
    }

    function createCell(text, className, tooltipText = "") {
      const div = document.createElement("div");
      if (className) div.classList.add(className);
      div.textContent = text;
      
      if (tooltipText) {
        const tooltip = document.createElement("span");
        tooltip.className = "tooltip";
        tooltip.textContent = tooltipText;
        div.appendChild(tooltip);

        div.addEventListener('mouseenter', () => {
          tooltip.style.opacity = '1';
        });

        div.addEventListener('mouseleave', () => {
          tooltip.style.opacity = '0';
        });

        div.addEventListener('mousemove', (e) => {
          tooltip.style.left = (e.clientX + 15) + 'px';
          tooltip.style.top = (e.clientY + 15) + 'px';
        });
      }
      return div;
    }

    function updateHighlights(shift, lang) {
        const today = new Date();
        const currentDayIndex = today.getDay() - 1; // 0=Mon ... 4=Fri
        const currentMinute = today.getHours() * 60 + today.getMinutes();
        const timetable = document.getElementById('timetable');
        const dayHeaders = timetable.querySelectorAll('.header');
        const isFriday = today.getDay() === 5;

        // Reset highlights
        dayHeaders.forEach(header => header.classList.remove('current-day-header'));
        document.querySelectorAll('.current-lesson').forEach(cell => cell.classList.remove('current-lesson', 'blinking'));

        if (currentDayIndex >= 0 && currentDayIndex <= 4) {
          // Highlight day header
          dayHeaders[currentDayIndex].classList.add('current-day-header');

          // Find lesson
          const lessonIndex = getLessonIndexForTime(shift, currentMinute, isFriday);

          if (lessonIndex !== -1) {
            const firstCellOfRow = dayHeaders.length + (lessonIndex * 5);
            const currentLessonCell = timetable.children[firstCellOfRow + currentDayIndex];
            if (currentLessonCell && currentLessonCell.textContent !== "") {
              currentLessonCell.classList.add('current-lesson', 'blinking');
            }
          }
        }
      }

    // New function to determine which lesson is currently active
    function getLessonIndexForTime(shift, currentMinute, isFriday) {
      let periods;
      if (isFriday) {
        periods = (shift === "morning") ? lessonTimes.morningFriday : lessonTimes.afternoonFriday;
      } else {
        periods = lessonTimes[shift];
      }
      for (let i = 0; i < periods.length; i++) {
        if (currentMinute >= periods[i].start && currentMinute < periods[i].end) {
          return i;
        }
      }
      return -1; // no lesson active
    }

    function render(lang) {
      const today = new Date();
      
      // Get manual shift from local storage, or fall back to automatic
      const manualShift = localStorage.getItem("manualShift");
      let shift = manualShift || getShiftForWeek(today);

      const tr = translations[lang];

      // Title
      document.getElementById("title").textContent = tr.title;

      // Today date
      let formattedDate;
      if (lang === 'bs') {
          const bsMonths = ["januar", "februar", "mart", "april", "maj", "juni", "juli", "august", "septembar", "oktobar", "novembar", "decembar"];
          const dayIndex = today.getDay();
          const bsDays = ["Nedjelja", "Ponedjeljak", "Utorak", "Srijeda", "Četvrtak", "Petak", "Subota"];
          formattedDate = `${bsDays[dayIndex]}, ${today.getDate()}. ${bsMonths[today.getMonth()]} ${today.getFullYear()}`;
      } else {
          const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
          formattedDate = today.toLocaleDateString(tr.locale, options);
      }
      document.getElementById("today-date").textContent = formattedDate;

      // Shift label + times
      const isFriday = today.getDay() === 5;
      if (shift === "morning") {
        document.getElementById("shift-label").textContent = tr.morning;
        document.getElementById("shift-time").textContent = isFriday ? tr.morningTimeFriday : tr.morningTime;
      } else {
        document.getElementById("shift-label").textContent = tr.afternoon;
        document.getElementById("shift-time").textContent = isFriday ? tr.afternoonTimeFriday : tr.afternoonTime;
      }

      // Build table
      buildTimetable(shift, lang);
      
      // Initial highlight update
      updateHighlights(shift, lang);

      // Set up a timer to update highlights every minute
      setInterval(() => updateHighlights(shift, lang), 60 * 1000);
    }

    // Theme toggle
    const themeBtn = document.getElementById("theme-toggle");
    themeBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      const dark = document.body.classList.contains("dark");
      themeBtn.textContent = dark ? "☀️ Light" : "🌙 Dark";
      localStorage.setItem("theme", dark ? "dark" : "light");
    });

    // Language select
    const langSelect = document.getElementById("language-select");
    langSelect.addEventListener("change", () => {
      const lang = langSelect.value;
      localStorage.setItem("lang", lang);
      render(lang);
    });

    // Shift toggle
    const shiftToggleBtn = document.getElementById("shift-toggle");
    shiftToggleBtn.addEventListener("click", () => {
        const currentShift = localStorage.getItem("manualShift") || getShiftForWeek(new Date());
        const newShift = (currentShift === 'morning') ? 'afternoon' : 'morning';
        localStorage.setItem('manualShift', newShift);
        render(localStorage.getItem('lang') || 'bs');
    });

    // Init
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
      document.body.classList.add("dark");
      themeBtn.textContent = "☀️ Light";
    }

    const savedLang = localStorage.getItem("lang") || "bs";
    langSelect.value = savedLang;
    render(savedLang);
  </script>
</body>
</html>
